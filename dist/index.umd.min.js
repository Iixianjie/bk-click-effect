!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).BkEffect=e()}(this,(function(){"use strict";var t=function(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t};var e=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);t.length>e;e++)n[e]=t[e];return n}};var n=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)};var o=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var i=function(t){return e(t)||n(t)||o()};var r=function(t){if(Array.isArray(t))return t};var a=function(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var n=[],o=!0,i=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!e||n.length!==e);o=!0);}catch(t){i=!0,r=t}finally{try{o||null==c.return||c.return()}finally{if(i)throw r}}return n}};var c=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var s=function(t,e){return r(t)||a(t,e)||c()};var u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")};function l(t,e){for(var n=0;e.length>n;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}var p=function(t,e,n){return e&&l(t.prototype,e),n&&l(t,n),t};function d(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,o)}return n}function f(e){for(var n=1;arguments.length>n;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?d(Object(o),!0).forEach((function(n){t(e,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):d(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var h=!1,v={effect:"fr-effect",disabled:"__disabled",disabledWinStyle:"__md",disabledMdStyle:"__win"};return function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,t),this.supportTouch="ontouchstart"in window,this.triggerEl=[],this.ripple=[],this.onDown=function(t){var n=e.getCurrentEl(t);if(n){var o=e.isEffectEl(n),i=e.isDisabledWinStyle(n),r=e.isDisabledMdStyle(n);!e.isDisabled(n)&&o&&(e.triggerEl.push(n),i||(e.onMove(t,!0),e.bindMoveEvent()),r||e.ripple.push(e.displayRipple(n,t)))}},this.onUp=function(){e.unbindMoveEvent(),e.ripple.forEach((function(t,n){t.setAttribute("data-hold",2),e.removeRipple(t),e.ripple.splice(n,1)}))},this.onMove=function(t,n){if(!e.stopFlag){e.stopFlag=!0,setTimeout((function(){e.stopFlag=!1}),100);var o=e.triggerEl[e.triggerEl.length-1],r=e.supportTouch?t.changedTouches[0]:t,a=o.getBoundingClientRect(),c=e.inArea(r,a);if(c||e.unbindMoveEvent(),c){var u=e.getOffestPos(r,a),l=s(u,2),p=e.getRotateRatio(a.width,a.height,l[0],l[1]);e.setRotate.apply(e,i(p).concat([o]))}}},this.inArea=function(t,e){return!(e.x>t.clientX||e.y>t.clientY||t.clientX>e.x+e.width||t.clientY>e.y+e.height)},h||(h=!0,this.option=f({},v,{},n),this.init())}return p(t,[{key:"init",value:function(){var t;this.bindUpEvent(),this.bindDownEvent(),this.injectStyle("\n    .".concat(t=this.option.effect," {\n      position: relative;\n      overflow: hidden;\n    }\n\n    .").concat(t,"-ripple {\n      position: absolute;\n      border-radius: 50%;\n      width: 0;\n      height: 0;\n      opacity: 1;\n      background: rgba(0,0,0,0.18);\n      transition: 0.6s ease-out;\n      transition-property: transform, opacity;\n      transform: scale3d(0, 0, 1);\n      pointer-events: none;\n    }\n    \n    .").concat(t,".__red .").concat(t,"-ripple{\n      background: rgba(245, 34, 45, 0.3);\n    }\n    \n    .").concat(t,".__orange .").concat(t,"-ripple{\n      background: rgba(250, 140, 22, 0.3);\n    }\n    \n    .").concat(t,".__yellow .").concat(t,"-ripple{\n      background: rgba(250, 219, 20, 0.3);\n    }\n    \n    .").concat(t,".__green .").concat(t,"-ripple{\n      background: rgba(82, 196, 26, 0.3);\n    }\n    \n    .").concat(t,".__cyan .").concat(t,"-ripple{\n      background: rgba(19, 194, 194, 0.3);\n    }\n    \n    .").concat(t,".__blue .").concat(t,"-ripple{\n      background: rgba(24, 144, 255, 0.3);\n    }\n    \n    .").concat(t,".__purple .").concat(t,"-ripple{\n      background: rgba(114, 46, 209, 0.3);\n    }\n        \n    .").concat(t,".__light .").concat(t,"-ripple{\n      background: rgba(255,255,255, 0.3);\n    }\n  "))}},{key:"displayRipple",value:function(t,e){var n=this,o=this.supportTouch?e.changedTouches[0]:e,i=t.getBoundingClientRect(),r=document.createElement("div"),a=this.getOffestPos(o,i),c=s(a,2),u=c[0],l=c[1],p=Math.max(1.8*i.width,1.8*i.height);return r.className="".concat(this.option.effect,"-ripple"),r.style.left="".concat(u-p/2,"px"),r.style.top="".concat(l-p/2,"px"),r.style.height="".concat(p,"px"),r.style.width="".concat(p,"px"),r.setAttribute("data-hold","1"),t.appendChild(r),setTimeout((function(){r.style.transform="scale3d(1, 1, 1)",r.style.opacity="0",n.removeRipple(r)})),r}},{key:"removeRipple",value:function(t){var e=this;1===+t.getAttribute("data-hold")?(t.style.opacity=1,setTimeout((function(){e.removeRipple(t)}),700)):setTimeout((function(){t.style.opacity=0,t.style.transition="all 0.3s ease-out",setTimeout((function(){t.parentNode&&t.parentNode.removeChild(t)}),300)}),300)}},{key:"getOffestPos",value:function(t,e){return[t.clientX-e.x,t.clientY-e.y]}},{key:"getRotateRatio",value:function(t,e,n,o){var i=this.calcRotateRatio(n/t),r=this.calcRotateRatio(o/e,!0);return[i,r,0===i&&0===r?.9:1,Math.max(4,20-Math.floor(Math.max(t,e)/30))]}},{key:"calcRotateRatio",value:function(t,e){return t>.3?.7>=t&&t>.3?0:e?-1:1:e?1:-1}},{key:"setRotate",value:function(t,e,n,o,i){console.log(o),i.style.transition="70ms ease-in-out",i.style.transformOrigin="50% 50%",i.style.transform="perspective(400px) rotate3d(".concat(e,", ").concat(t,", 0, ").concat(o,"deg) scale3d(").concat(n,", ").concat(n,", 1)"),i.style.userSelect="none"}},{key:"removeRotate",value:function(){this.triggerEl&&this.triggerEl.forEach((function(t){t.style.transformOrigin="",t.style.transform="",t.style.userSelect="",setTimeout((function(){t.style.transition=""}),70)}))}},{key:"bindUpEvent",value:function(){this.supportTouch?(document.addEventListener("touchend",this.onUp,!1),document.addEventListener("touchcancel",this.onUp,!1)):(document.addEventListener("mouseup",this.onUp,!1),document.addEventListener("mouseleave",this.onUp,!1),document.addEventListener("dragend",this.onUp,!1))}},{key:"bindDownEvent",value:function(){this.supportTouch?document.addEventListener("touchstart",this.onDown,!1):document.addEventListener("mousedown",this.onDown,!1)}},{key:"bindMoveEvent",value:function(){this.supportTouch?document.addEventListener("touchmove",this.onMove,{passive:!1}):document.addEventListener("mousemove",this.onMove,!1)}},{key:"unbindMoveEvent",value:function(){this.removeRotate(),this.supportTouch?document.removeEventListener("touchmove",this.onMove):document.removeEventListener("mousemove",this.onMove)}},{key:"injectStyle",value:function(t){var e=document.createElement("style");e.setAttribute("type","text/css"),e.setAttribute("symbol","fr-effect"),e.innerHTML=t,document.head.appendChild(e)}},{key:"getCurrentEl",value:function(t){return this.getWavesEffectElement(t)}},{key:"isEffectEl",value:function(t){return-1!==t.className.indexOf(this.option.effect)}},{key:"isDisabledWinStyle",value:function(t){return-1!==t.className.indexOf(this.option.disabledWinStyle)}},{key:"isDisabledMdStyle",value:function(t){return-1!==t.className.indexOf(this.option.disabledMdStyle)}},{key:"isDisabled",value:function(t){return RegExp(this.option.disabled+"(\\s|)$").test(t.className)}},{key:"getWavesEffectElement",value:function(t){for(var e=null,n=t.target||t.srcElement;null!==n.parentNode;){if(!(n instanceof SVGElement)&&-1!==n.className.indexOf(this.option.effect)){e=n;break}n=n.parentNode}return e}}]),t}()}));
