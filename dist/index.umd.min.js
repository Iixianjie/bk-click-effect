!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).BkEffect=t()}(this,(function(){"use strict";var e=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var t=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);e.length>t;t++)n[t]=e[t];return n}};var n=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)};var o=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")};var i=function(e){return t(e)||n(e)||o()};var r=function(e){if(Array.isArray(e))return e};var a=function(e,t){var n=[],o=!0,i=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(o=(a=c.next()).done)&&(n.push(a.value),!t||n.length!==t);o=!0);}catch(e){i=!0,r=e}finally{try{o||null==c.return||c.return()}finally{if(i)throw r}}return n};var c=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")};var s=function(e,t){return r(e)||a(e,t)||c()};var u=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")};function l(e,t){for(var n=0;t.length>n;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var p=function(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e};function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function f(t){for(var n=1;arguments.length>n;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?d(o,!0).forEach((function(n){e(t,n,o[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):d(o).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var v=!1,h={effect:"fr-effect",disabled:"__disabled",disabledWinStyle:"__md",disabledMdStyle:"__win"};return function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};u(this,e),this.supportTouch="ontouchstart"in window,this.triggerEl=[],this.ripple=[],this.onDown=function(e){var n=t.getCurrentEl(e);if(n){var o=t.isEffectEl(n),i=t.isDisabledWinStyle(n),r=t.isDisabledMdStyle(n);!t.isDisabled(n)&&o&&(t.triggerEl.push(n),i||(t.onMove(e,!0),t.bindMoveEvent()),r||t.ripple.push(t.displayRipple(n,e)))}},this.onUp=function(){t.unbindMoveEvent(),t.ripple.forEach((function(e,n){e.setAttribute("data-hold",2),t.removeRipple(e),t.ripple.splice(n,1)}))},this.onMove=function(e,n){if(!t.stopFlag){t.stopFlag=!0,setTimeout((function(){t.stopFlag=!1}),100);var o=t.triggerEl[t.triggerEl.length-1],r=t.supportTouch?e.changedTouches[0]:e,a=o.getBoundingClientRect(),c=t.inArea(r,a);if(c||t.unbindMoveEvent(),c){var u=t.getOffestPos(r,a),l=s(u,2),p=t.getRotateRatio(a.width,a.height,l[0],l[1]);t.setRotate.apply(t,i(p).concat([o]))}}},this.inArea=function(e,t){return!(t.x>e.clientX||t.y>e.clientY||e.clientX>t.x+t.width||e.clientY>t.y+t.height)},v||(v=!0,this.option=f({},h,{},n),this.init())}return p(e,[{key:"init",value:function(){var e;this.bindUpEvent(),this.bindDownEvent(),this.injectStyle("\n    .".concat(e=this.option.effect," {\n      position: relative;\n      overflow: hidden;\n    }\n    \n    .").concat(e,".__light .").concat(e,"-ripple{\n      background: rgba(255,255,255, 0.3);\n    }\n    \n    .").concat(e,".__red .").concat(e,"-ripple{\n      background: rgba(245, 34, 45, 0.3);\n    }\n    \n    .").concat(e,".__orange .").concat(e,"-ripple{\n      background: rgba(250, 140, 22, 0.3);\n    }\n    \n    .").concat(e,".__yellow .").concat(e,"-ripple{\n      background: rgba(250, 219, 20, 0.3);\n    }\n    \n    .").concat(e,".__green .").concat(e,"-ripple{\n      background: rgba(82, 196, 26, 0.3);\n    }\n    \n    .").concat(e,".__cyan .").concat(e,"-ripple{\n      background: rgba(19, 194, 194, 0.3);\n    }\n    \n    .").concat(e,".__blue .").concat(e,"-ripple{\n      background: rgba(24, 144, 255, 0.3);\n    }\n    \n    .").concat(e,".__purple .").concat(e,"-ripple{\n      background: rgba(114, 46, 209, 0.3);\n    }\n    \n    .").concat(e,"-ripple {\n      position: absolute;\n      border-radius: 50%;\n      width: 0;\n      height: 0;\n      opacity: 1;\n      background: rgba(0,0,0,0.14);\n      transition: 0.6s ease-out;\n      transition-property: transform, opacity;\n      transform: scale3d(0, 0, 1);\n      pointer-events: none;\n    }\n  "))}},{key:"displayRipple",value:function(e,t){var n=this,o=this.supportTouch?t.changedTouches[0]:t,i=e.getBoundingClientRect(),r=document.createElement("div"),a=this.getOffestPos(o,i),c=s(a,2),u=c[0],l=c[1],p=Math.max(1.8*i.width,1.8*i.height);return r.className="".concat(this.option.effect,"-ripple"),r.style.left="".concat(u-p/2,"px"),r.style.top="".concat(l-p/2,"px"),r.style.height="".concat(p,"px"),r.style.width="".concat(p,"px"),r.setAttribute("data-hold","1"),e.appendChild(r),setTimeout((function(){r.style.transform="scale3d(1, 1, 1)",r.style.opacity="0",n.removeRipple(r)})),r}},{key:"removeRipple",value:function(e){var t=this;1===+e.getAttribute("data-hold")?(e.style.opacity=1,setTimeout((function(){t.removeRipple(e)}),700)):setTimeout((function(){e.style.opacity=0,e.style.transition="all 0.3s ease-out",setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),300)}),300)}},{key:"getOffestPos",value:function(e,t){return[e.clientX-t.x,e.clientY-t.y]}},{key:"getRotateRatio",value:function(e,t,n,o){var i=this.calcRotateRatio(n/e),r=this.calcRotateRatio(o/t,!0);return[i,r,0===i&&0===r?.9:1]}},{key:"calcRotateRatio",value:function(e,t){return e>.3?.7>=e&&e>.3?0:t?-1:1:t?1:-1}},{key:"setRotate",value:function(e,t,n,o){o.style.transition="70ms ease-in-out",o.style.transformOrigin="50% 50%",o.style.transform="perspective(400px) rotate3d(".concat(t,", ").concat(e,", 0, 8deg) scale3d(").concat(n,", ").concat(n,", 1)"),o.style.userSelect="none"}},{key:"removeRotate",value:function(){this.triggerEl&&this.triggerEl.forEach((function(e){e.style.transformOrigin="",e.style.transform="",e.style.userSelect="",setTimeout((function(){e.style.transition=""}),70)}))}},{key:"bindUpEvent",value:function(){this.supportTouch?(document.addEventListener("touchend",this.onUp,!1),document.addEventListener("touchcancel",this.onUp,!1)):(document.addEventListener("mouseup",this.onUp,!1),document.addEventListener("mouseleave",this.onUp,!1),document.addEventListener("dragend",this.onUp,!1))}},{key:"bindDownEvent",value:function(){this.supportTouch?document.addEventListener("touchstart",this.onDown,!1):document.addEventListener("mousedown",this.onDown,!1)}},{key:"bindMoveEvent",value:function(){this.supportTouch?document.addEventListener("touchmove",this.onMove,{passive:!1}):document.addEventListener("mousemove",this.onMove,!1)}},{key:"unbindMoveEvent",value:function(){this.removeRotate(),this.supportTouch?document.removeEventListener("touchmove",this.onMove):document.removeEventListener("mousemove",this.onMove)}},{key:"injectStyle",value:function(e){var t=document.createElement("style");t.setAttribute("type","text/css"),t.setAttribute("symbol","fr-effect"),t.innerHTML=e,document.head.appendChild(t)}},{key:"getCurrentEl",value:function(e){return this.getWavesEffectElement(e)}},{key:"isEffectEl",value:function(e){return-1!==e.className.indexOf(this.option.effect)}},{key:"isDisabledWinStyle",value:function(e){return-1!==e.className.indexOf(this.option.disabledWinStyle)}},{key:"isDisabledMdStyle",value:function(e){return-1!==e.className.indexOf(this.option.disabledMdStyle)}},{key:"isDisabled",value:function(e){return RegExp(this.option.disabled+"(\\s|)$").test(e.className)}},{key:"getWavesEffectElement",value:function(e){for(var t=null,n=e.target||e.srcElement;null!==n.parentNode;){if(!(n instanceof SVGElement)&&-1!==n.className.indexOf(this.option.effect)){t=n;break}n=n.parentNode}return t}}]),e}()}));
